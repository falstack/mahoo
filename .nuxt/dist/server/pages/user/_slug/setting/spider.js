exports.ids = [17];
exports.modules = {

/***/ 181:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony default export */ __webpack_exports__["a"] = ([{
  type: 'douga',
  main: true,
  left: {
    slug: 1,
    name: '动画',
    type: 'MainFlowTab'
  },
  right: {
    slug: 1,
    name: '特别推荐',
    type: 'RecommendedSwipe'
  }
}, {
  type: 'bangumi',
  main: true,
  left: {
    slug: 5,
    name: '番剧',
    type: 'BangumiSwitcher'
  },
  right: {
    slug: 5,
    type: 'RankSwitcher'
  }
}, {
  type: 'bangumi-about',
  main: false,
  left: {
    slug: 8,
    name: '番剧动态',
    type: 'MainFlowTab'
  },
  right: {
    slug: 8,
    type: 'RankDaily'
  }
}, {
  type: 'manga',
  main: true,
  left: {
    slug: 4,
    name: '漫画',
    type: 'MainFlowTab'
  },
  right: {
    slug: 4,
    type: 'RankSwitcher'
  }
}, {
  type: 'game',
  main: true,
  left: {
    slug: 2,
    name: '游戏',
    type: 'MainFlowTab'
  },
  right: {
    slug: 2,
    type: 'RankSwitcher'
  }
}, {
  type: 'novel',
  main: true,
  left: {
    slug: 6,
    name: '帖子',
    type: 'MainFlowTab'
  },
  right: {
    slug: 6,
    type: 'RankDaily'
  }
}, {
  type: 'music',
  main: true,
  left: {
    slug: 7,
    name: '音乐',
    type: 'MainFlowTab'
  },
  right: {
    slug: 7,
    type: 'RankSwitcher'
  }
}, {
  type: 'life',
  main: true,
  left: {
    slug: 3,
    name: '生活',
    type: 'MainFlowTab'
  },
  right: {
    slug: 3,
    type: 'RankSwitcher'
  }
}]);

/***/ }),

/***/ 182:
/***/ (function(module, exports) {

// Exports
module.exports = {};


/***/ }),

/***/ 250:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(182);
/* harmony import */ var _node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_node_modules_css_loader_dist_cjs_js_ref_7_oneOf_1_0_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_7_oneOf_1_1_node_modules_sass_loader_dist_cjs_js_ref_7_oneOf_1_2_node_modules_sass_resources_loader_lib_loader_js_ref_7_oneOf_1_3_node_modules_vue_loader_lib_index_js_vue_loader_options_spider_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 291:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// CONCATENATED MODULE: ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./pages/user/_slug/setting/spider.vue?vue&type=template&id=03990868&
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.isAuth)?_c('div',{attrs:{"id":"user-spider-setting"}},[(_vm.user.providers.bind_bilibili)?[_c('ElAlert',{attrs:{"title":"什么是频道id？","type":"success"}},[_c('span',[_vm._v("比如：")]),_vm._v(" "),_c('a',{attrs:{"target":"_blank","href":"https://space.bilibili.com/279662469/channel/detail?cid=118679"}},[_vm._v("https://space.bilibili.com/279662469/channel/detail?cid=118679")]),_vm._v(" "),_c('span',[_vm._v("这个链接中，频道部分就是cid=118679，那么频道的 id 就是")]),_vm._v(" "),_c('span',[_c('b',[_vm._v("118679")])])]),_vm._ssrNode(" <br> "),_c('ElAlert',{attrs:{"title":"请勿频繁的修改规则","type":"warning"}},[_vm._v("\n      如果你删除规则，calibur 也会删除对应的内容，但这个过程需要几分钟至几小时的同步时间\n    ")]),_vm._ssrNode(" <br> "),_c('ElAlert',{attrs:{"title":"你只能填写自己的频道id，填写他人的是无效的","type":"error"}}),_vm._ssrNode(" <br> "),_vm._l((_vm.rule),function(item,index){return _vm._ssrNode("<div class=\"rule-item\">","</div>",[_c('ElButton',{staticClass:"close-btn",attrs:{"type":"text","icon":"el-icon-close"},on:{"click":function($event){return _vm.deleteRuleItem(index)}}}),_vm._ssrNode(" <p class=\"opt-item type\"><span class=\"label\">类型：</span> <span class=\"value\">"+_vm._ssrEscape(_vm._s(_vm.convertSourceType(item.type)))+"</span></p> "),_vm._ssrNode("<p class=\"opt-item channel\">","</p>",[_vm._ssrNode("<span class=\"label\">分区：</span> "),_vm._ssrNode("<span class=\"value\">","</span>",[_c('ElSelect',{attrs:{"placeholder":"请选择分区"},model:{value:(item.source_type),callback:function ($$v) {_vm.$set(item, "source_type", $$v)},expression:"item.source_type"}},_vm._l((_vm.channel),function(opt){return _c('ElOption',{key:opt.id,attrs:{"label":opt.name,"value":opt.id}})}),1)],1)],2),_vm._ssrNode(" "),_vm._ssrNode("<p class=\"opt-item source\">","</p>",[_vm._ssrNode("<span class=\"label\">资源：</span> "),_vm._l((item.channel_id),function(cnn,idx){return _c('ElTag',{key:cnn,attrs:{"type":"success","closable":""},on:{"close":function($event){return _vm.handleClose(item, idx)}}},[_c('a',{attrs:{"target":"_blank","href":_vm.convertSourceUrl(cnn)},domProps:{"textContent":_vm._s(cnn)}})])}),_vm._ssrNode(" "),_c('ElInput',{attrs:{"placeholder":"输入频道id后回车","size":"small"},nativeOn:{"keyup":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")){ return null; }return _vm.handleInputConfirm(item)}},model:{value:(item.new),callback:function ($$v) {_vm.$set(item, "new", $$v)},expression:"item.new"}})],2)],2)}),_vm._ssrNode(" "),_vm._ssrNode("<div class=\"submit-row\">","</div>",[_c('ElButton',{attrs:{"icon":"el-icon-plus","circle":""},on:{"click":_vm.appendRule}}),_vm._ssrNode(" "),_c('ElButton',{attrs:{"loading":_vm.submitting,"plain":"","type":"success"},on:{"click":_vm.saveRule}},[_vm._v("\n        确认保存\n      ")])],2)]:_c('ElAlert',{attrs:{"title":"请先在「认证设置」页面绑定你的B站账号","type":"success"}})],2):_vm._e()}
var staticRenderFns = []


// CONCATENATED MODULE: ./pages/user/_slug/setting/spider.vue?vue&type=template&id=03990868&

// EXTERNAL MODULE: external "element-ui/lib/tag"
var tag_ = __webpack_require__(24);
var tag_default = /*#__PURE__*/__webpack_require__.n(tag_);

// EXTERNAL MODULE: external "element-ui/lib/option"
var option_ = __webpack_require__(68);
var option_default = /*#__PURE__*/__webpack_require__.n(option_);

// EXTERNAL MODULE: external "element-ui/lib/select"
var select_ = __webpack_require__(69);
var select_default = /*#__PURE__*/__webpack_require__.n(select_);

// EXTERNAL MODULE: external "element-ui/lib/alert"
var alert_ = __webpack_require__(65);
var alert_default = /*#__PURE__*/__webpack_require__.n(alert_);

// EXTERNAL MODULE: ./config/channel.js
var channel = __webpack_require__(181);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib??ref--2-0!./node_modules/vue-loader/lib??vue-loader-options!./pages/user/_slug/setting/spider.vue?vue&type=script&lang=js&




//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

/* harmony default export */ var spidervue_type_script_lang_js_ = ({
  name: 'UserSpiderSetting',
  components: {
    ElAlert: alert_default.a,
    ElSelect: select_default.a,
    ElOption: option_default.a,
    ElTag: tag_default.a
  },

  data() {
    return {
      submitting: false,
      rule: [],
      user_bilibili_mid: 0
    };
  },

  computed: {
    isAuth() {
      return this.$store.state.isAuth;
    },

    user() {
      return this.$store.state.user;
    },

    channel() {
      return channel["a" /* default */].filter(_ => _.main).map(_ => {
        return {
          id: _.left.slug,
          name: _.left.name
        };
      }).filter(_ => ~[1, 2, 3].indexOf(_.id));
    }

  },

  mounted() {
    this.getUserRule();
  },

  methods: {
    appendRule() {
      this.rule.push({
        key: Math.random().toString(36).substring(3, 6),
        channel_id: [],
        type: 'video',
        source_type: 1,
        new: ''
      });
    },

    deleteRuleItem(index) {
      this.rule.splice(index, 1);
    },

    saveRule() {
      if (this.submitting) {
        return;
      }

      this.submitting = true;
      this.$axios.$post('v1/console/spider/save_user_rule', {
        channel: 'bilibili',
        rule: this.rule
      }).then(() => {
        this.$toast.success('设置成功！').then(() => {
          window.location.reload();
        });
      }).catch(err => {
        this.submitting = false;
        this.$toast.error(err.message);
      });
    },

    handleClose(item, index) {
      item.channel_id.splice(index, 1);
    },

    convertSourceType(type) {
      return {
        video: '视频'
      }[type];
    },

    convertSourceUrl(cid) {
      return `https://space.bilibili.com/${this.user_bilibili_mid}/channel/detail?cid=${cid}`;
    },

    handleInputConfirm(item) {
      if (!item.new || !/^\d+$/.test(item.new)) {
        return;
      }

      item.channel_id.push(item.new);
      item.new = '';
    },

    getUserRule() {
      this.$axios.$get('v1/console/spider/get_user_rule', {
        params: {
          channel: 'bilibili'
        }
      }).then(res => {
        if (!res || !res.rule) {
          return;
        }

        this.user_bilibili_mid = res.user_id;
        let rule;

        try {
          rule = JSON.parse(res.rule);
        } catch (e) {
          rule = [];
        }

        if (!rule) {
          rule = [];
        }

        rule.forEach((item, index) => {
          rule[index].key = Math.random().toString(36).substring(3, 6);
          rule[index].new = '';
        });
        this.$set(this, 'rule', rule);
      }).catch(err => {
        this.$toast.error(err.message);
      });
    }

  }
});
// CONCATENATED MODULE: ./pages/user/_slug/setting/spider.vue?vue&type=script&lang=js&
 /* harmony default export */ var setting_spidervue_type_script_lang_js_ = (spidervue_type_script_lang_js_); 
// EXTERNAL MODULE: ./node_modules/vue-loader/lib/runtime/componentNormalizer.js
var componentNormalizer = __webpack_require__(1);

// CONCATENATED MODULE: ./pages/user/_slug/setting/spider.vue



function injectStyles (context) {
  
  var style0 = __webpack_require__(250)
if (style0.__inject__) style0.__inject__(context)

}

/* normalize component */

var component = Object(componentNormalizer["a" /* default */])(
  setting_spidervue_type_script_lang_js_,
  render,
  staticRenderFns,
  false,
  injectStyles,
  null,
  "ac3cdd8e"
  
)

/* harmony default export */ var spider = __webpack_exports__["default"] = (component.exports);

/***/ })

};;
//# sourceMappingURL=spider.js.map