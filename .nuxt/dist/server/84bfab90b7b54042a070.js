exports.ids=[11],exports.modules={170:function(t,e){t.exports={undefined:void 0}},280:function(t,e,n){"use strict";n.r(e);var o=n(170),r=n.n(o);for(var l in o)"default"!==l&&function(t){n.d(e,t,(function(){return o[t]}))}(l);e.default=r.a},366:function(t,e,n){"use strict";n.r(e);var o={name:"BangumiJoin",layout:"app",mixins:[n(90).a],data:()=>({showLaunch:!0,showCreate:!1,rule:null,sheet:null,bangumi:null,questions:[],selected:{},loading:!1}),computed:{slug(){return this.$route.query.slug}},watch:{},created(){},mounted(){this.getBangumiInfo(),this.getBangumiRule()},methods:{getBangumiRule(){this.$axios.$get("v1/join/rule/show",{params:{slug:this.slug}}).then(data=>{this.rule=data}).catch(t=>{this.$toast.error(t.message)})},getBangumiInfo(){this.$axios.$get("v1/bangumi/show",{params:{slug:this.slug}}).then(data=>{this.bangumi=data}).catch(t=>{this.$toast.error(t.message)})},handleBegin(){this.$axios.$post("v1/join/begin",{slug:this.slug}).then(t=>{"reject"===t?this.$toast.info("该分区还未开放"):"resolve"===t?this.$toast.info("你已加入该分区"):"no_rule"===t?this.$toast.info("还没有答题规则"):"no_question"===t?(this.$toast.info("分区题目数量不足"),this.showCreate=!0):"pending"===t&&this.getQuestions()}).catch(t=>{this.$toast.error(t.message)})},getQuestions(){this.$axios.$get("v1/join/list",{params:{slug:this.slug}}).then(data=>{this.selected=data.extra.answers||{},this.questions=data.result,this.showLaunch=!1}).catch(t=>{this.$toast.error(t.message)})},handleSelect(t,e){this.$axios.$post("v1/join/vote",{question_id:t,answer_id:e}).then(()=>{this.selected[t]=e}).catch(t=>{this.$toast.error(t.message)})},restart(){this.$confirm("你会获取一套新的试题，确定要重做吗？").then(()=>{this.loading||(this.loading=!0,this.$axios.$post("v1/join/begin",{slug:this.slug,retry:!0}).then(()=>{this.getQuestions()}).catch(t=>{this.$toast.error(t.message)}).finally(()=>{this.loading=!1}))}).catch(()=>{})},submit(){Object.keys(this.selected).length<this.questions.length?this.$toast.info("请先做完所有题目"):this.loading||(this.loading=!0,this.$axios.$post("v1/join/submit",{slug:this.slug}).then(t=>{this.$toast.info(t).then(()=>{(/qq/.test(window.navigator.userAgent.toLowerCase())?window.qq:window.wx).miniProgram.redirectTo({url:`/pages/bangumi/show/index?slug=${this.slug}`})})}).catch(t=>{this.$toast.error(t.message)}).finally(()=>{this.loading=!1}))}},head:{title:"答题"}},r=n(1);var component=Object(r.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"bangumi-join"}},[t.showLaunch?t._ssrNode('<div class="launch">',"</div>",[t._ssrNode((t.bangumi?"<img"+t._ssrAttr("src",t.$resize(t.bangumi.avatar,{width:150}))+' alt class="avatar"> <p>'+t._ssrEscape("加入《"+t._s(t.bangumi.name)+"》")+"</p>":"\x3c!----\x3e")+" "+(t.rule?"<ul><li>"+t._ssrEscape("该番剧出题："+t._s(t.rule.question_count)+"道")+"</li> <li>"+t._ssrEscape("正确率需要："+t._s(t.rule.right_rate)+"%")+"</li></ul>":"\x3c!----\x3e")+" "),n("ElButton",{attrs:{type:"success",round:""},on:{click:t.handleBegin}},[t._v("开始答题")]),t._ssrNode(" "),t.showCreate?n("NLink",{attrs:{to:"/app/bangumi/test?slug="+t.slug}},[t._v("出题")]):t._e()],2):[t._ssrNode('<ol class="question-list">'+t._ssrList(t.questions,(function(e){return'<li class="question-item"><p class="question">'+t._s(e.title)+'</p> <ol class="answers">'+t._ssrList(e.answers,(function(n,o){return"<li"+t._ssrClass(null,{"is-selected":t.selected[e.id]&&t.selected[e.id]===o})+"><span>"+t._s(n)+"</span></li>"}))+'</ol> <div class="controls"><div><span>出题人：</span> <span>'+t._ssrEscape(t._s(e.user.nickname))+"</span></div></div></li>"}))+"</ol> "),t.questions.length?t._ssrNode('<footer slot="footer" class="qa-footer">',"</footer>",[n("ElButton",{staticClass:"submit-btn",attrs:{loading:t.loading,type:"success",round:""},on:{click:t.submit}},[t._v("\n        交卷\n      ")])],1):t._e()]],2)}),[],!1,(function(t){var e=n(280);e.__inject__&&e.__inject__(t)}),null,"d7adfc5c");e.default=component.exports},90:function(t,e,n){"use strict";e.a={beforeMount(){this.$channel.$when("user-not-sign",()=>{this.$toast.error("继续操作前请先登录").then(()=>{window.location.href=this.$alias.sign()})})}}}};