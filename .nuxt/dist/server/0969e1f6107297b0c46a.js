exports.ids=[1],exports.modules={38:function(t,e){t.exports={undefined:void 0}},39:function(t,e){t.exports={undefined:void 0}},40:function(t,e,o){"use strict";var n=o(13);e.a={async beforeMount(){if(this.$store.state.logging){const t=this.$watch("$store.state.logging",()=>{this.$store.state.isAuth?(this.$channel.$fire("user-signed"),t()):(this.$cookie.remove("JWT-TOKEN"),this.$channel.$fire("user-not-sign"))})}else{const t=Object(n.a)();this.$store.commit("SET_USER_TOKEN",t),await this.$store.dispatch("initAuth")?(this.$channel.$fire("user-signed"),this.$store.dispatch("getUserRoles")):(this.$cookie.remove("JWT-TOKEN"),this.$channel.$fire("user-not-sign"))}}}},46:function(t,e){t.exports={undefined:void 0}},47:function(t,e){t.exports={undefined:void 0}},48:function(t,e){t.exports={undefined:void 0}},49:function(t,e){t.exports={undefined:void 0}},50:function(t,e){t.exports={undefined:void 0}},51:function(t,e){t.exports={undefined:void 0}},59:function(t,e){t.exports={undefined:void 0}},60:function(t,e,o){"use strict";o.r(e);var n=o(48),r=o.n(n);for(var c in n)"default"!==c&&function(t){o.d(e,t,(function(){return n[t]}))}(c);e.default=r.a},61:function(t,e,o){"use strict";o.r(e);var n=o(49),r=o.n(n);for(var c in n)"default"!==c&&function(t){o.d(e,t,(function(){return n[t]}))}(c);e.default=r.a},62:function(t,e,o){"use strict";o.r(e);var n=o(50),r=o.n(n);for(var c in n)"default"!==c&&function(t){o.d(e,t,(function(){return n[t]}))}(c);e.default=r.a},63:function(t,e,o){"use strict";o.r(e);var n=o(51),r=o.n(n);for(var c in n)"default"!==c&&function(t){o.d(e,t,(function(){return n[t]}))}(c);e.default=r.a},66:function(t,e,o){"use strict";o.r(e);o(59),o(38);var n=o(37),r=o.n(n),c=(o(46),o(34)),h=o.n(c),l=(o(39),o(33)),d=o.n(l),m=(o(47),o(35)),f=o.n(m),v=o(2),w={name:"SignInForm",components:{VForm:f.a,VButton:d.a,VField:h.a,VRadio:r.a},data:()=>({form:{access:"",secret:"",remember:!0},rule:{access:{validator:(t,e,o)=>e?11!==e.length?o(new Error("请填写11位手机号")):void o():o(new Error("请填写手机号"))},secret:{validator:(t,e,o)=>""===e?o(new Error("请填写登录密码")):e.length<6?o(new Error("密码不能小于6位")):e.length>16?o(new Error("密码不能大于16位")):void o()}},loading:!1,showOAuth:!0}),methods:{authQQ(){window.location.href="https://api.calibur.tv/callback/oauth2/qq?from=sign"},authWechat(){window.location.href="https://api.calibur.tv/callback/oauth2/wechat?from=sign"},redirect(){return this.$route.query.redirect?this.$route.query.redirect:encodeURIComponent(window.location.href)},login(){this.loading||(this.loading=!0,Object(v.d)(this,{access:this.form.access,secret:this.form.secret,remember:this.form.remember}).then(t=>{this.$cookie.set("JWT-TOKEN",t,{expires:this.form.remember?365:1}),this.$route.query.redirect?window.location=decodeURIComponent(this.$route.query.redirect):window.location.reload()}).catch(t=>{this.$toast.error(t.message),this.loading=!1}))},showReset(){this.$emit("to-reset")},showRegister(){this.$emit("to-register")}}},_=o(5);var $=Object(_.a)(w,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"sign-in-form"},[o("VForm",{attrs:{loading:t.loading,form:t.form,rule:t.rule,error:!1},on:{submit:t.login}},[o("VField",{attrs:{type:"text",placeholder:"手机（填写常用手机号，用于登录）"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access","string"==typeof e?e.trim():e)},expression:"form.access"}}),t._v(" "),o("VField",{attrs:{type:"password","show-password":"",placeholder:"密码（6-16个字符组成，区分大小写）"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm(e)}},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret","string"==typeof e?e.trim():e)},expression:"form.secret"}}),t._v(" "),o("div",{staticClass:"opt-container"},[o("VRadio",{attrs:{size:"small",label:"记住我"},model:{value:t.form.remember,callback:function(e){t.$set(t.form,"remember",e)},expression:"form.remember"}}),t._v(" "),t.showOAuth?o("ul",{staticClass:"provider"},[o("li",{on:{click:t.authQQ}},[o("i",{staticClass:"iconfont ic-qq"})]),t._v(" "),o("li",{on:{click:t.authWechat}},[o("i",{staticClass:"iconfont ic-v-chat"})])]):o("button",{attrs:{type:"button"},on:{click:function(e){t.showOAuth=!0}}},[t._v("\n        社交账号登录\n      ")])],1),t._v(" "),o("VButton",{attrs:{slot:"submit",loading:t.loading,size:"large",block:"",round:""},slot:"submit"},[t._v("\n      登录\n    ")])],1),t._ssrNode(' <div class="others"><a>忘记密码?&gt;</a> <a>点击注册»</a></div>')],2)}),[],!1,(function(t){var e=o(60);e.__inject__&&e.__inject__(t)}),null,"224ccb1e").exports,y={name:"SignUpForm",components:{VForm:f.a,VButton:d.a,VField:h.a},props:{inviteCode:{type:[String,Number],default:""}},data(){return{form:{access:"",secret:"",authCode:"",inviteCode:this.inviteCode},rule:{access:{validator:(t,e,o)=>e?11!==e.length?o(new Error("请填写11位手机号")):/^(0|86|17951)?(1)[0-9]{10}$/.test(e)?void o():o(new Error("错误的手机号格式")):o(new Error("请填写手机号"))},secret:{validator:(t,e,o)=>""===e?o(new Error("请填写登录密码")):e.length<6?o(new Error("密码不能小于6位")):e.length>16?o(new Error("密码不能大于16位")):void o()}},step:0,timeout:0}},computed:{submitBtnText(){return 0===this.step?"注册":1===this.step?"提交中...":2===this.step?"短信已发送":3===this.step?"注册中...":"注册"},submitBtnLoading(){return 1===this.step||3===this.step},submitBtnDisabled(){return 0!==this.timeout&&0===this.step||3===this.step},query(){return this.$route.query},paramsIsOK(){return!!(this.query.uid&&/^\d+$/.test(this.query.uid)&&this.query.time&&/^\d+$/.test(this.query.time)&&Date.now()<=1e3*this.query.time&&this.query.key===this.$md5(`${this.query.uid}-the-world-${this.query.time}`))}},methods:{addInviteForLink(t){let e=t;return this.paramsIsOK?e=`${e}&invite=${this.query.uid}`:"about-invite-id"===this.$route.name&&(e=`${e}&invite=${this.$route.params.id}`),e},qqRegisterLink(){window.location.href=`${this.addInviteForLink("https://api.calibur.tv/callback/oauth2/qq?from=sign")}}`},wechatRegisterLink(){window.location.href=`${this.addInviteForLink("https://api.calibur.tv/callback/oauth2/wechat?from=sign")}}`},redirect(){return this.$route.query.redirect?this.$route.query.redirect:encodeURIComponent(window.location.href)},submitForm(){0===this.step&&this.getRegisterAuthCode(),2===this.step&&this.openConfirmModal()},async getRegisterAuthCode(){this.step=1;try{await Object(v.h)(this,{type:"sign_up",phone_number:this.form.access}),this.step=2,this.openConfirmModal()}catch(t){this.$toast.error(t.message),this.step=0}finally{this.timeout=60;const t=setInterval(()=>{--this.timeout||(this.step=0,clearInterval(t))},1e3)}},openConfirmModal(){this.$prompt("请输入收到的验证码","短信已发送",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d{6}$/,inputErrorMessage:"验证码格式不正确"}).then(({value:t})=>{this.form.authCode=t,this.step=3,this.signUp()}).catch(()=>{})},signUp(){Object(v.f)(this,{access:this.form.access,secret:this.form.secret,authCode:this.form.authCode,inviteCode:this.form.inviteCode}).then(t=>{this.$cookie.set("JWT-TOKEN",t),this.$toast.success("注册成功！").then(()=>{this.$route.query.redirect?window.location=decodeURIComponent(this.$route.query.redirect):window.location.reload()})}).catch(t=>{this.step=0,this.$toast.error(t.message)})},showLogin(){this.$emit("to-login")}}};var C=Object(_.a)(y,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"sign-up-form"},[o("VForm",{attrs:{loading:t.submitBtnLoading,form:t.form,rule:t.rule,error:!1},on:{submit:t.submitForm}},[o("VField",{attrs:{type:"text",placeholder:"手机（填写常用手机号，用于登录）","auto-complete":"off"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access","string"==typeof e?e.trim():e)},expression:"form.access"}}),t._v(" "),o("VField",{attrs:{type:"password","show-password":"",placeholder:"密码（6-16个字符组成，区分大小写）","auto-complete":"off"},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret","string"==typeof e?e.trim():e)},expression:"form.secret"}}),t._v(" "),t.inviteCode?t._e():o("VField",{attrs:{placeholder:"邀请码（可为空）","auto-complete":"off"},model:{value:t.form.inviteCode,callback:function(e){t.$set(t.form,"inviteCode","string"==typeof e?e.trim():e)},expression:"form.inviteCode"}}),t._v(" "),o("VButton",{attrs:{slot:"submit",loading:t.submitBtnLoading,disabled:t.submitBtnDisabled,size:"large",block:"",round:""},slot:"submit"},[t._v("\n      "+t._s(t.submitBtnText)+"\n      "),t.timeout?[t._v(" （"+t._s(t.timeout)+"s 后可重新获取） ")]:t._e()],2)],1),t._ssrNode(' <div class="others"><ul class="provider"><span>社交账号注册</span> <li><i class="iconfont ic-qq"></i></li> <li><i class="iconfont ic-v-chat"></i></li></ul> '+(t.inviteCode?"\x3c!----\x3e":"<a>已有账号»</a>")+"</div>")],2)}),[],!1,(function(t){var e=o(61);e.__inject__&&e.__inject__(t)}),null,"ea587432").exports,x={name:"ResetPasswordForm",components:{VForm:f.a,VButton:d.a,VField:h.a},data:()=>({form:{access:"",secret:"",authCode:""},rule:{access:[{validator:(t,e,o)=>e?11!==e.length?o(new Error("请填写11位手机号")):void o():o(new Error("请填写手机号")),trigger:"blur"}],secret:[{validator:(t,e,o)=>""===e?o(new Error("请填写登录密码")):e.length<6?o(new Error("密码不能小于6位")):e.length>16?o(new Error("密码不能大于16位")):void o(),trigger:"blur"}]},step:0,timeout:0}),computed:{submitBtnText(){return 0===this.step?"立即重置":1===this.step?"提交中...":2===this.step?"短信已发送":3===this.step?"已重置":"立即重置"},submitBtnLoading(){return 1===this.step||3===this.step},submitBtnDisabled(){return 0!==this.timeout&&0===this.step||3===this.step}},methods:{submitForm(){0===this.step&&this.getResetAuthCode(),2===this.step&&this.openConfirmModal()},async getResetAuthCode(){this.step=1;try{await Object(v.h)(this,{type:"forgot_password",phone_number:this.form.access}),this.step=2,this.openConfirmModal()}catch(t){this.$toast.error(t.message),this.step=0}finally{this.timeout=60;const t=setInterval(()=>{--this.timeout||(this.step=0,clearInterval(t))},1e3)}},openConfirmModal(){this.$prompt("请输入收到的验证码","短信已发送",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d{6}$/,inputErrorMessage:"验证码格式不正确"}).then(({value:t})=>{this.form.authCode=t,this.step=3,this.signReset()}).catch(()=>{})},async signReset(){try{const t=await Object(v.g)(this,{access:this.form.access,authCode:this.form.authCode,secret:this.form.secret});this.$toast.success(t),this.showLogin()}catch(t){this.$toast.error(t.message)}finally{this.step=0}},showLogin(){this.$emit("to-login")},showRegister(){this.$emit("to-register")}}};var k={name:"SignDialog",components:{SignUpForm:C,SignInForm:$,ResetPasswordForm:Object(_.a)(x,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"reset-password-form"},[o("VForm",{attrs:{loading:t.submitBtnLoading,form:t.form,rule:t.rule},on:{submit:t.submitForm}},[o("VField",{attrs:{type:"text",placeholder:"手机号","auto-complete":"off"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access","string"==typeof e?e.trim():e)},expression:"form.access"}}),t._v(" "),o("VField",{attrs:{type:"text",placeholder:"新密码","auto-complete":"off"},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret","string"==typeof e?e.trim():e)},expression:"form.secret"}}),t._v(" "),o("VButton",{attrs:{slot:"submit",loading:t.submitBtnLoading,disabled:t.submitBtnDisabled,size:"large",block:"",round:""},slot:"submit"},[t._v("\n      "+t._s(t.submitBtnText)+"\n      "),t.timeout?[t._v(" （"+t._s(t.timeout)+"s 后可重新获取） ")]:t._e()],2)],1),t._ssrNode(' <div class="others"><a>返回登录&gt;</a> <a>点击注册»</a></div>')],2)}),[],!1,(function(t){var e=o(62);e.__inject__&&e.__inject__(t)}),null,"5d3315f3").exports},data:()=>({canRender:!1,showModal:!1,showSignIn:!1,showSignUp:!1,showReset:!1}),computed:{isGuest(){return!this.$store.state.isAuth}},mounted(){this.canRender=!0,this.$channel.$on("sign-in",()=>{window.screen.width<=768?window.location.href=this.$alias.sign():this.showLogin()}),this.$channel.$on("sign-up",()=>{this.showRegister()})},methods:{showLogin(){this.showReset=!1,this.showModal=!0,this.showSignIn=!0,this.showSignUp=!1},showRegister(){this.showModal=!0,this.showSignUp=!0,this.showSignIn=!1},hiddenSign(){this.showModal=!1,this.showSignIn=!1,this.showSignUp=!1,this.showReset=!1}}};var S={beforeMount(){this.$channel.$when("user-signed",()=>{const t=()=>Date.now()-this.$cache.get("socket-connect-heartbeat",0)<=1e3;setTimeout(()=>{const e=()=>{this.$channel.socketConnect();const t=setInterval(()=>{this.$store.state.socket.isConnected?this.$cache.set("socket-connect-heartbeat",Date.now()):clearInterval(t)},1e3);window.addEventListener("beforeunload",()=>{this.$channel.socketDisconnect()})},o=()=>{const o=setInterval(()=>{t()?Date.now()-this.$cache.get("socket-on-message-time",0)<=1e3&&this.$store.commit("SOCKET_ONMESSAGE",this.$cache.get("socket-on-message-data")):"visible"===document.visibilityState&&(e(),clearInterval(o))},2e3)};t()||"visible"!==document.visibilityState?(this.$store.commit("SOCKET_AUTO_CONNECT"),o()):e()},2e3)})},beforeDestroy(){this.$store.state.socket.isConnected&&this.$channel.socketDisconnect()}},R={name:"Layout",components:{SignDialog:Object(_.a)(k,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.canRender?o("div",{staticClass:"sign-container"},[t.isGuest?t._ssrNode('<div id="space3D"'+t._ssrClass(null,[t.showModal?"space-enter":"space-leave"])+">","</div>",[t._ssrNode('<div class="sign-modal-wrap">',"</div>",[t._ssrNode("<div"+t._ssrClass("sign-modal sign-in-modal",{"sign-in-init":!t.showSignIn&&!t.showSignUp,"sign-in-show":t.showSignIn&&!t.showSignUp,"sign-in-turn":!t.showSignIn&&t.showSignUp})+">","</div>",[t._ssrNode('<div class="sign-logo"></div> '),o("ResetPasswordForm",{directives:[{name:"show",rawName:"v-show",value:t.showReset,expression:"showReset"}],on:{"to-login":function(e){t.showReset=!1},"to-register":t.showRegister}}),t._ssrNode(" "),o("SignInForm",{directives:[{name:"show",rawName:"v-show",value:!t.showReset,expression:"!showReset"}],on:{"to-reset":function(e){t.showReset=!0},"to-register":t.showRegister}})],2),t._ssrNode(" "),t._ssrNode("<div"+t._ssrClass("sign-modal sign-up-modal",{"sign-up-init":!t.showSignUp&&!t.showSignIn,"sign-up-show":t.showSignUp&&!t.showSignIn,"sign-up-turn":!t.showSignUp&&t.showSignIn})+">","</div>",[t._ssrNode('<div class="sign-logo"></div> '),o("SignUpForm",{on:{"to-login":t.showLogin}})],2)],2)]):t._e()]):t._e()}),[],!1,(function(t){var e=o(63);e.__inject__&&e.__inject__(t)}),null,"79bf5a35").exports},mixins:[o(40).a,S]},E=Object(_.a)(R,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"layout-web"}},[e("nuxt"),this._ssrNode(" "),e("SignDialog")],2)}),[],!1,null,null,"9d4724dc");e.default=E.exports}};