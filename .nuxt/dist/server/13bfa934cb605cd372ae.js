exports.ids=[59],exports.modules={337:function(t,e){t.exports={undefined:void 0}},338:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return l}));n(337),n(84);var o=n(67),r=n.n(o);class l{static get toolbox(){return{icon:'<svg width="13" height="14" xmlns="http://www.w3.org/2000/svg">\n  <path d="M8.567 13.629c.728.464 1.581.65 2.41.558l-.873.873A3.722 3.722 0 1 1 4.84 9.794L6.694 7.94a3.722 3.722 0 0 1 5.256-.008L10.484 9.4a5.209 5.209 0 0 1-.017.016 1.625 1.625 0 0 0-2.29.009l-1.854 1.854a1.626 1.626 0 0 0 2.244 2.35zm2.766-7.358a3.722 3.722 0 0 0-2.41-.558l.873-.873a3.722 3.722 0 1 1 5.264 5.266l-1.854 1.854a3.722 3.722 0 0 1-5.256.008L9.416 10.5a5.2 5.2 0 0 1 .017-.016 1.625 1.625 0 0 0 2.29-.009l1.854-1.854a1.626 1.626 0 0 0-2.244-2.35z" transform="translate(-3.667 -2.7)"/>\n</svg>',title:"超链接"}}static get enableLineBreaks(){return!0}constructor({data:data,config:t,api:e}){this.api=e,this.config={endpoint:t.endpoint||""},this.nodes={wrapper:null,container:null,progress:null,input:null,inputHolder:null,linkContent:null,linkImage:null,linkTitle:null,linkDescription:null,linkText:null},this._data={link:"",meta:{}},this.data=data}render(){return this.nodes.wrapper=this.make("div",this.CSS.baseClass),this.nodes.container=this.make("div",this.CSS.container),this.nodes.inputHolder=this.makeInputHolder(),this.nodes.linkContent=this.prepareLinkPreview(),Object.keys(this.data.meta).length?(this.nodes.container.appendChild(this.nodes.linkContent),this.showLinkPreview(this.data.meta)):this.nodes.container.appendChild(this.nodes.inputHolder),this.nodes.wrapper.appendChild(this.nodes.container),this.nodes.wrapper}save(){return this.data}set data(data){this._data=Object.assign({},{link:data.link||this._data.link,meta:data.meta||this._data.meta})}get data(){return this._data}get CSS(){return{baseClass:this.api.styles.block,input:this.api.styles.input,container:"link-tool",inputEl:"link-tool__input",inputHolder:"link-tool__input-holder",inputError:"link-tool__input-holder--error",linkContent:"link-tool__content",linkContentRendered:"link-tool__content--rendered",linkImage:"link-tool__image",linkTitle:"link-tool__title",linkDescription:"link-tool__description",linkText:"link-tool__anchor",progress:"link-tool__progress",progressLoading:"link-tool__progress--loading",progressLoaded:"link-tool__progress--loaded"}}makeInputHolder(){const t=this.make("div",this.CSS.inputHolder);return this.nodes.progress=this.make("label",this.CSS.progress),this.nodes.input=this.make("div",[this.CSS.input,this.CSS.inputEl],{contentEditable:!0}),this.nodes.input.dataset.placeholder="Link",this.nodes.input.addEventListener("paste",t=>{this.startFetching(t)}),this.nodes.input.addEventListener("keydown",t=>{const[e,n]=[13,65],o=t.ctrlKey||t.metaKey;switch(t.keyCode){case e:t.preventDefault(),t.stopPropagation(),this.startFetching(t);break;case n:o&&this.selectLinkUrl(t)}}),t.appendChild(this.nodes.progress),t.appendChild(this.nodes.input),t}startFetching(t){let e=this.nodes.input.textContent;"paste"===t.type&&(e=(t.clipboardData||window.clipboardData).getData("text")),this.removeErrorStyle(),this.fetchLinkData(e)}removeErrorStyle(){this.nodes.inputHolder.classList.remove(this.CSS.inputError),this.nodes.inputHolder.insertBefore(this.nodes.progress,this.nodes.input)}selectLinkUrl(t){t.preventDefault(),t.stopPropagation();const e=window.getSelection(),n=new Range,o=e.anchorNode.parentNode.closest(`.${this.CSS.inputHolder}`).querySelector(`.${this.CSS.inputEl}`);n.selectNodeContents(o),e.removeAllRanges(),e.addRange(n)}prepareLinkPreview(){const t=this.make("a",this.CSS.linkContent,{target:"_blank",rel:"nofollow noindex noreferrer"});return this.nodes.linkImage=this.make("div",this.CSS.linkImage),this.nodes.linkTitle=this.make("div",this.CSS.linkTitle),this.nodes.linkDescription=this.make("p",this.CSS.linkDescription),this.nodes.linkText=this.make("span",this.CSS.linkText),t}showLinkPreview({image:image,title:title,description:t}){this.nodes.container.appendChild(this.nodes.linkContent),image&&image.url&&(this.nodes.linkImage.style.backgroundImage="url("+image.url+")",this.nodes.linkContent.appendChild(this.nodes.linkImage)),title&&(this.nodes.linkTitle.textContent=title,this.nodes.linkContent.appendChild(this.nodes.linkTitle)),t&&(this.nodes.linkDescription.textContent=t,this.nodes.linkContent.appendChild(this.nodes.linkDescription)),this.nodes.linkContent.classList.add(this.CSS.linkContentRendered),this.nodes.linkContent.setAttribute("href",this.data.link),this.nodes.linkContent.appendChild(this.nodes.linkText);try{this.nodes.linkText.textContent=new URL(this.data.link).hostname}catch(t){this.nodes.linkText.textContent=this.data.link}}showProgress(){this.nodes.progress.classList.add(this.CSS.progressLoading)}hideProgress(){return new Promise(t=>{this.nodes.progress.classList.remove(this.CSS.progressLoading),this.nodes.progress.classList.add(this.CSS.progressLoaded),setTimeout(t,500)})}applyErrorStyle(){this.nodes.inputHolder.classList.add(this.CSS.inputError),this.nodes.progress.remove()}async fetchLinkData(t){if(t.includes(".")){/^https?:\/\//.test(t)||(t="https://"+t);try{new URL(t)}catch(t){return}this.showProgress(),this.data={link:t};try{const e=await r.a.get({url:this.config.endpoint,data:{url:t}});this.onFetch(e.body)}catch(t){this.fetchingFailed("服务暂时不可用")}}}onFetch(t){if(!t||!t.success)return void this.fetchingFailed("不支持的链接");const e=t.meta;this.data={meta:e},e?this.hideProgress().then(()=>{this.nodes.inputHolder.remove(),this.showLinkPreview(e)}):this.fetchingFailed("服务暂不可用")}fetchingFailed(t){this.api.notifier.show({message:t,style:"error"}),this.applyErrorStyle()}make(t,e=null,n={}){const o=document.createElement(t);Array.isArray(e)?o.classList.add(...e):e&&o.classList.add(e);for(const t in n)o[t]=n[t];return o}}}};