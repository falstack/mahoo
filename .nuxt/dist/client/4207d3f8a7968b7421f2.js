(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{459:function(e,t,n){"use strict";t.a=[{type:"douga",main:!0,left:{slug:1,name:"动画",type:"MainFlowTab"},right:{slug:1,name:"特别推荐",type:"RecommendedSwipe"}},{type:"bangumi",main:!0,left:{slug:5,name:"番剧",type:"BangumiSwitcher"},right:{slug:5,type:"RankSwitcher"}},{type:"bangumi-about",main:!1,left:{slug:3,name:"番剧动态",type:"MainFlowTab"},right:{slug:3,type:"RankDaily"}},{type:"manga",main:!0,left:{slug:4,name:"漫画",type:"MainFlowTab"},right:{slug:4,type:"RankSwitcher"}},{type:"game",main:!0,left:{slug:2,name:"游戏",type:"MainFlowTab"},right:{slug:2,type:"RankSwitcher"}},{type:"novel",main:!0,left:{slug:6,name:"帖子",type:"MainFlowTab"},right:{slug:6,type:"RankDaily"}},{type:"music",main:!0,left:{slug:7,name:"音乐",type:"MainFlowTab"},right:{slug:7,type:"RankSwitcher"}},{type:"dance",main:!0,left:{slug:8,name:"舞蹈",type:"MainFlowTab"},right:{slug:8,type:"RankSwitcher"}}]},460:function(e,t,n){},561:function(e,t,n){"use strict";var l=n(460);n.n(l).a},611:function(e,t,n){"use strict";n.r(t);n(30),n(43),n(13),n(91),n(53),n(176),n(19),n(9),n(37),n(14);var l=n(129),r=n.n(l),c=n(425),o=n.n(c),m=n(423),d=n.n(m),h=n(364),_=n.n(h),f=n(459),y={name:"UserSpiderSetting",components:{ElAlert:_.a,ElSelect:d.a,ElOption:o.a,ElTag:r.a},data:function(){return{submitting:!1,rule:[],user_bilibili_mid:0}},computed:{isAuth:function(){return this.$store.state.isAuth},channel:function(){return f.a.filter((function(e){return e.main})).map((function(e){return{id:e.left.slug,name:e.left.name}})).filter((function(e){return~[1,2].indexOf(e.id)}))}},mounted:function(){this.getUserRule()},methods:{appendRule:function(){this.rule.push({key:Math.random().toString(36).substring(3,6),channel_id:[],type:"video",source_type:1,new:""})},deleteRuleItem:function(e){this.rule.splice(e,1)},saveRule:function(){var e=this;this.submitting||(this.submitting=!0,this.$axios.$post("v1/console/spider/save_user_rule",{channel:"bilibili",rule:this.rule}).then((function(){e.$toast.success("设置成功！").then((function(){window.location.reload()}))})).catch((function(t){e.submitting=!1,e.$toast.error(t.message)})))},handleClose:function(e,t){e.channel_id.splice(t,1)},convertSourceType:function(e){return{video:"视频"}[e]},convertSourceUrl:function(e){return"https://space.bilibili.com/".concat(this.user_bilibili_mid,"/channel/detail?cid=").concat(e)},handleInputConfirm:function(e){e.new&&/^\d+$/.test(e.new)&&(e.channel_id.push(e.new),e.new="")},getUserRule:function(){var e=this;this.$axios.$get("v1/console/spider/get_user_rule",{params:{channel:"bilibili"}}).then((function(t){if(t&&t.rule){var n;e.user_bilibili_mid=t.user_id;try{n=JSON.parse(t.rule)}catch(e){n=[]}n||(n=[]),n.forEach((function(e,t){n[t].key=Math.random().toString(36).substring(3,6),n[t].new=""})),e.$set(e,"rule",n)}else e.user_bilibili_mid=null})).catch((function(t){e.$toast.error(t.message)}))}}},v=(n(561),n(7)),component=Object(v.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isAuth?n("div",{attrs:{id:"user-spider-setting"}},[e.user_bilibili_mid?[n("ElAlert",{attrs:{title:"什么是频道id？",type:"success"}},[n("span",[e._v("比如：")]),e._v(" "),n("a",{attrs:{target:"_blank",href:"https://space.bilibili.com/279662469/channel/detail?cid=118679"}},[e._v("https://space.bilibili.com/279662469/channel/detail?cid=118679")]),e._v(" "),n("span",[e._v("这个链接中，频道部分就是cid=118679，那么频道的 id 就是")]),e._v(" "),n("span",[n("b",[e._v("118679")])])]),e._v(" "),n("br"),e._v(" "),n("ElAlert",{attrs:{title:"请勿频繁的修改规则",type:"warning"}},[e._v("\n      如果你删除规则，calibur 也会删除对应的内容，但这个过程需要几分钟至几小时的同步时间\n    ")]),e._v(" "),n("br"),e._v(" "),e._l(e.rule,(function(t,l){return n("div",{key:t.key,staticClass:"rule-item"},[n("ElButton",{staticClass:"close-btn",attrs:{type:"text",icon:"el-icon-close"},on:{click:function(t){return e.deleteRuleItem(l)}}}),e._v(" "),n("p",{staticClass:"opt-item type"},[n("span",{staticClass:"label"},[e._v("类型：")]),e._v(" "),n("span",{staticClass:"value",domProps:{textContent:e._s(e.convertSourceType(t.type))}})]),e._v(" "),n("p",{staticClass:"opt-item channel"},[n("span",{staticClass:"label"},[e._v("分区：")]),e._v(" "),n("span",{staticClass:"value"},[n("ElSelect",{attrs:{placeholder:"请选择分区"},model:{value:t.source_type,callback:function(n){e.$set(t,"source_type",n)},expression:"item.source_type"}},e._l(e.channel,(function(e){return n("ElOption",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)]),e._v(" "),n("p",{staticClass:"opt-item source"},[n("span",{staticClass:"label"},[e._v("资源：")]),e._v(" "),e._l(t.channel_id,(function(l,r){return n("ElTag",{key:l,attrs:{type:"success",closable:""},on:{close:function(n){return e.handleClose(t,r)}}},[n("a",{attrs:{target:"_blank",href:e.convertSourceUrl(l)},domProps:{textContent:e._s(l)}})])})),e._v(" "),n("ElInput",{attrs:{placeholder:"输入频道id后回车",size:"small"},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:t.new,callback:function(n){e.$set(t,"new",n)},expression:"item.new"}})],2)],1)})),e._v(" "),n("div",{staticClass:"submit-row"},[n("ElButton",{attrs:{icon:"el-icon-plus",circle:""},on:{click:e.appendRule}}),e._v(" "),n("ElButton",{attrs:{loading:e.submitting,plain:"",type:"success"},on:{click:e.saveRule}},[e._v("确认保存")])],1)]:null===e.user_bilibili_mid?n("ElAlert",{attrs:{title:"请先在「认证设置」页面绑定你的B站账号",type:"success"}}):e._e()],2):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);